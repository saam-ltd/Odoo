<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
	<!-- Form View -->
    <record id="schedule_planning_form" model="ir.ui.view">
        <field name="name">schedule.planning.form</field>
        <field name="model">schedule.planning</field>
        <field name="arch" type="xml">
            <form string="Schedule Planning">
                <header>
					<button string="Confirm" 
						name="action_schedule_confirm" 
						states="draft" 
						type="object" class="oe_highlight" />
					<button string="Create Schedule Activities" 
						name="action_create_schedule_activity" 
						states="confirm" 
						type="object" class="oe_highlight" />
					<button string="Reset to Draft" 
						name="action_schedule_draft" 
						states="cancel" type="object"/>
					<button string="Cancel" 
						name="action_schedule_cancel" 
						states="confirm" type="object"/>
					<field name="state" widget="statusbar" />
				</header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" attrs="{'readonly':[('state','!=','draft')]}"/>
                        </h1>
                    </div>
                    <group>
                    	<group>
							<label for="start_date" string="Period"/>
							<div>
								<div name="date_edit_only" class="o_row oe_edit_only">
									<span>From <field name="start_date" class='oe_inline' attrs="{'readonly':[('state','!=','draft')]}"/></span>
									<span>To <field name="end_date" class='oe_inline' attrs="{'readonly':[('state','!=','draft')]}"/></span>
								</div>
								<div name="date_read_only" class="o_row oe_read_only">
									<span attrs="{'invisible': [('start_date', '=', False)]}">From <field name="start_date" class='oe_inline'/></span>
									<span attrs="{'invisible': [('end_date', '=', False)]}">To <field name="end_date" class='oe_inline'/></span>
								</div>
							</div>
						</group>
                        <group>

                        </group>
                        <group>
                        	<field name="custom_salesperson_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="manager_id" invisible='1' force_save='1'/>
                            <field name="linked_user_id" readonly='1' force_save='1' invisible='1'/>
                            <button type="object" name="generate_weekday_entries" string="Update Lines"
                                        icon="fa-arrow-circle-o-right" class="oe_highlight" attrs="{'invisible':[('state','!=','draft')],'readonly':[('state','!=','draft')]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Schedule Planning Lines" name="schedule_lines">
                            <field name="schedule_plan_lines" attrs="{'readonly':[('state','!=','draft')]}">
                                <tree string="Schedule Lines" editable="top">
                                    <field name="date" />
                                    <field name="dayofweek" />
                                   <field name="customer_ids"  widget="many2many_tags"/> 
                                   <field name="activity_type_id" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                    <group>
                        <field name="note" placeholder="Comments...." nolabel='1' attrs="{'readonly':[('state','not in',('draft','confirm'))]}"/>
                    </group>
            	</sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

	<!-- Tree View -->
    <record id="schedule_planning_tree" model="ir.ui.view">
        <field name="name">schedule.planning.tree</field>
        <field name="model">schedule.planning</field>
        <field name="arch" type="xml">
            <tree string="Schedule Planning">
                <field name="name"/>
                <field name="custom_salesperson_id"/>                
                <field name="state"
				   widget="badge"
				   decoration-warning="state in ('draft')"
				   decoration-info="state in ('confirm')"
				   decoration-success="state in ('activity_created')"/>
			</tree>
        </field>
    </record>

    <record id="mail_activity_view_form_inherit_schedule" model="ir.ui.view">
        <field name="name">mail.activity.view.form.inherit.schedule</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_form_popup"/>
        <field name="arch" type="xml">
        	<xpath expr="//form/sheet" position="before">
        		<header>
                     <button string="Start" type="object" class="oe_highlight" icon="fa-play"
                                    attrs="{'invisible': ['|',('activity_state', '!=', 'draft'), ('is_from_scheduled_planning', '!=', True)]}" name="action_timer_start"/>
                            <!-- <button string="Pause" type="object" class="oe_highlight" icon="fa-pause"
                                    attrs="{'invisible': [('activity_state', '!=', 'running')]}" name="action_timer_pause"/> -->
                            <button string="Stop" type="object" class="oe_highlight" icon="fa-stop"
                                    attrs="{'invisible': ['|',('activity_state', '!=', 'running'), ('is_from_scheduled_planning', '!=', True)]}" name="action_timer_stop"/>

                   <!--  <button string="Start" type="object" name="action_timer_start" class="oe_highlight" attrs="{'invisible': ['|',('activity_state', '!=', 'draft'), ('is_from_scheduled_planning', '!=', True)]}"/> -->

                    <button string="Mark as Done" type="object" name="action_mark_done"  class="oe_highlight" attrs="{'invisible': ['|',('activity_state', '!=', 'stopped'), ('is_from_scheduled_planning', '!=', True)]}"/>
                    <button string="Cancel" type="object" name="action_mark_cancel"  class="oe_highlight" 
                    	attrs="{'invisible': ['|',('activity_state', '!=', 'draft'), ('is_from_scheduled_planning', '!=', True)]}"/>
                    <field name="activity_state" widget="statusbar" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}"/>
                </header>
        	</xpath>
        	<field name="activity_type_id" position="before">
                <field name="res_name" invisible='1'/>
                <field name="custom_salesperson_id" string="Salesperson" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)],'readonly': [('is_from_scheduled_planning', '=', True)]}"/>
                <field name="customer_id" string="Customer" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)],'readonly': [('is_from_scheduled_planning', '=', True)]}" />
    			<span class="o_form_label o_td_label" name="address_name" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}">
    				<b>Address</b>
    			</span>
    			<div class="o_address_format" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}" >
    				<field name="street" placeholder="Street..." class="o_address_street" readonly='1'/>
                    <field name="street2" placeholder="Street 2..." class="o_address_street" readonly='1'/>
                    <field name="city" placeholder="City" class="o_address_city" readonly='1'/>
                    <field name="state_id" class="o_address_state" placeholder="State" context="{'country_id': country_id, 'default_country_id': country_id, 'zip': zip}" readonly='1'/>
                    <field name="zip" placeholder="ZIP" class="o_address_zip" readonly='1'/>
                    <field name="country_id" placeholder="Country" class="o_address_country" readonly='1'/>
    			</div>
    			<field name="mobile" readonly="1" string="Mobile" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}"/>
	            <field name="phone" readonly="1" string="Phone" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}"/>
	            <field name="email" readonly="1" string="Email" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}"/>
                <field name="is_from_scheduled_planning" invisible="1" string="From Schedule Planning"/>


            </field>
            <field name="date_deadline" position="replace">
            	<field name="date_deadline" string="Date" attrs="{'readonly': [('is_from_scheduled_planning', '!=', False)]}"/>
            </field>
            <field name="activity_type_id" position="replace">
            	<field name="activity_type_id" attrs="{'readonly': [('is_from_scheduled_planning', '!=', False)]}"/>
            </field>
            <field name="user_id" position="after">
                <field name="start_time" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}"/>
                <field name="end_time" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}"/>
                <field name="elapsed_time" string="Duration" attrs="{'invisible': [('is_from_scheduled_planning', '!=', True)]}"/>
            </field>
            <field name="user_id" position="replace">
            	<field name="user_id" attrs="{'readonly': [('is_from_scheduled_planning', '!=', False)],'invisible': [('is_from_scheduled_planning', '!=', False)]}"/>
            </field>
            
            <field name="summary" position="replace">
            	<field name="summary" attrs="{'readonly':[('activity_state','not in',('draft','running','stopped'))]}"/>
            </field>
            <field name="note" position="replace">
                <field name="note" attrs="{'readonly':[('activity_state','not in',('draft','running','stopped'))]}"/>
            </field>
            <footer position="replace"/>
        </field>
    </record>
    
     <record id="mail_activity_view_tree_inherit_schedule" model="ir.ui.view">
        <field name="name">mail.activity.view.tree.inherit.schedule</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_tree"/>
        <field name="arch" type="xml">
            <field name="res_name" position="replace">
                <field name="res_name" invisible='1'/>
            </field>
            <field name="date_deadline" position="replace">
                <field name="date_deadline" invisible='1'/>
            </field>
            <field name="res_name" position="replace">
                <field name="date_deadline" string="Date"/>
                <field name="custom_salesperson_id"/>
                <field name="customer_id"/>
                <field name="phone"/>
                <field name="zip"/>
                <field name="elapsed_time" string="Duration"/>
                <field name="user_id" optional="hide"/>
            </field>
            <field name="activity_type_id" position="after">
                <field name="activity_state" 
                    widget="badge"
                    decoration-warning="activity_state in ('draft')"
                    decoration-success="activity_state in ('done')"  string="State"/>
            </field>
        </field>
    </record>

    <!-- Search view inherit -->
    <record id="mail_activity_view_search_inheirt" model="ir.ui.view">
        <field name="name">mail.activity.view.search.inherit</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_search"/>
        <field name="arch" type="xml">
            <xpath expr="//search" type="inside">
                <field name="custom_salesperson_id"/>
                <field name="customer_id"/>
                <!-- Group By -->
                <filter name="group_by_custom_salesperson_id" string="Salesperson" context="{'group_by': 'custom_salesperson_id'}"/>
                <filter name="group_by_customer_id" string="Customer" context="{'group_by': 'customer_id'}"/>
                <filter name="group_by_activity_state" string="State" context="{'group_by': 'activity_state'}"/>
                <filter string="Today" name="today" domain="[('date_deadline','>=',time.strftime('%%Y-%%m-%%d')),('date_deadline','&lt;=',time.strftime('%%Y-%%m-%%d'))]"/>
                <filter string="Tomorrow" name="tomorrow" 
                    domain="[('date_deadline', '>=',  (context_today() + datetime.timedelta(days=1)).strftime('%%Y-%%m-%%d')),
                    ('date_deadline', '&lt;=',  (context_today() + datetime.timedelta(days=1)).strftime('%%Y-%%m-%%d'))]"/>

            </xpath>
        </field>
    </record>

    
    
	<!-- Action View -->
     <record id="action_schedule_planning" model="ir.actions.act_window">
        <field name="name">Schedule Planning</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">schedule.planning</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="mail_activity_action_inherit_schedule" model="ir.actions.act_window">
        <field name="name">Activities - Schedule</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mail.activity</field>
        <field name="domain">[('activity_state','!=','done'),('is_from_scheduled_planning','=',True)]</field>  
        <field name="view_ids" eval="[(5, 0, 0),
		    (0, 0, {'view_mode': 'tree', 'view_id': ref('mail_activity_view_tree_inherit_schedule')}),
		    (0, 0, {'view_mode': 'form', 'view_id': ref('mail_activity_view_form_inherit_schedule')}),
		    ]"/>
		    <field name="view_mode">tree</field>
    </record>

    <!-- <record id="mail_activity_action_inherit_schedule" model="ir.actions.server">
        <field name="name">Activities - Schedule</field>
        <field name="model_id" ref="mail.model_mail_activity"/>
        <field name="state">code</field>
        <field name="code">
            action = model.action_planned_scheduled_activities()
        </field>
        
    </record> -->
  
 
    <record id="mail_activity_action_inherit_done" model="ir.actions.act_window">
        <field name="name">Done - Activities</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mail.activity</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('activity_state','=','done')]</field>
    </record>

	<!-- Menu Details -->

     <!-- <menuitem 
        id="main_menu_route_plan"
        name="Route Plan" 
        sequence="20"
        web_icon="saam_extension,static/description/icon.png" 
        />        

    <menuitem id="menu_schedule_planning_parent_id" name="Schedule Planning" parent="main_menu_route_plan" sequence="1"/>

    <menuitem id="menu_schedule_planning" name="Schedule Planning" parent="menu_schedule_planning_parent_id" sequence="1" 
    	action="action_schedule_planning"/>

    <menuitem id="planned_activities_menu" name="Planned Activities" parent="menu_schedule_planning_parent_id" sequence="2" 
    	action="mail_activity_action_inherit_schedule"/>

    <menuitem id="done_activities_menu" name="Done Activities" parent="menu_schedule_planning_parent_id" sequence="3" 
    	action="mail_activity_action_inherit_done"/>
 -->
</odoo>
